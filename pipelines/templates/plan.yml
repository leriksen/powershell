stages:
  - stage: terraform_plan
    displayName: Terraform Plan
    jobs:
      - job: terraform_plan
        displayName: Terraform Plan
        workspace:
          clean: all
        steps:
          - task: Bash@3
            displayName: terraform init
            env:
              TF_TOKEN_app_terraform_io: $(tfc_token)
            inputs:
              targetType: filePath
              filePath: scripts/terraform_init.sh
              workingDirectory: $(System.DefaultWorkingDirectory)/terraform

          - task: Bash@3
            displayName: terraform plan
            name: plan # needed for result later
            env:
              TF_TOKEN_app_terraform_io: $(tfc_token)
            inputs:
              targetType: filePath
              filePath: scripts/terraform_plan.sh
              workingDirectory: $(System.DefaultWorkingDirectory)/terraform
